# santatecla-listados-1
## PHASE 0

### APP Name
AULA VIRTUAL - MOODDLE

### Group members

| Name and Surname     |Mail		   | Github        |
|:--------------------:|:-----------:|:--------------:|
| Hector Mediero de la Morena| h.mediero.2016@alumnos.urjc.es | HectorM15|
| Ana Álvarez Ortiz| a.alvarezo.2016@alumnos.urjc.es   | ana11alvarez   |
| Aitana Cerezo Camino  | a.cerezoc.2016@alumnos.urjc.es|Aitanaceca    |
| Sandra Cañadas Gómez | s.canadas.2016@alumnos.urjc.es    |   sandra1012     |
| Ernesto Baltasar Nve Obono | eb.nve@alumnos.urjc.es    |   nveobono     |

### Auxiliary tools
#### TRELLO
* To organize the tasks and assign them we have used the trello tool:
 [Trello grupo 9](https://trello.com/b/kwE4oDnN/grupo10-daw).
* For the development of the application we have used : WEBSTROM
* The requirements document: https://docs.google.com/document/d/1eq-zIDgxicw_UoEpP-LEa3dN-9cM59FqMHtBGM7VUPw/edit?usp=sharing


### Bibliography

1. [Github](https://github.com)

2. [Best practices GitHub](https://github.com/trein/dev-best-practices/wiki/Git-Commit-Best-Practices)

3. [Good commit messages](https://github.com/erlang/otp/wiki/writing-good-commit-messages)

4. [Trello](https://trello.com)

5. [New tolls,forums and features Github](https://github.com/blog/2256-a-whole-new-github-universe-announcing-new-tools-forums-and-features)

## PHASE 1
### Screenshots

Login: It is a view, where the user's login is required. There are three login options: through Facebook, twitter or Google, by using email and password or in guest / visitor mode. Depending on the type of user, it takes us to the corresponding main view type.

![login](https://user-images.githubusercontent.com/43374601/52230735-7398d480-28b8-11e9-8590-f9adfdcc4a20.png)

Teacher Started View: In this view, the topics and concepts appear, and the option to delete or add them, which only appear if you have logged in as a teacher. There is also a button to see a diagram with progress, another to return to start and another to close the session. We also add the option to search, to access a topic or concept faster.

![started view teacher](https://user-images.githubusercontent.com/43374601/52230739-74316b00-28b8-11e9-88d6-fd4172591725.jpeg)

Student / Visitor Started View: In this view, we only have the reading mode of the topics and concepts because the session has been logged as a student or visitor. In the started view of the student or visitor mode, we also find the start button, the diagrams button, the log out button and the search option.

![started view student](https://user-images.githubusercontent.com/43374601/52230738-74316b00-28b8-11e9-973d-a311afc0213f.jpeg)

Teacher Concept View: In this view we have two tables, one with already corrected items, where the correct or incorrect option is already checked and there is also the option to delete. In the second table we have uncorrected answers where there are two options per answer to mark if it is correct or incorrect. Below the first table, we have a button to add items, where a pop up appears. And in the upper right corner we have the option of log out.

![concept teacher](https://user-images.githubusercontent.com/43374601/52182541-76cf8a00-27fe-11e9-8787-7a096d00e4ce.png)
![concept teacher 2](https://user-images.githubusercontent.com/43374601/52182542-7a631100-27fe-11e9-8198-3d5305f27f13.png)

Student / Visitor Concept View: In this view we have a table with two parts: corrected questions and questions to be corrected. The corrected questions appear with a tick or with a cross depending on whether the question is correct or not. Below is an icon of a sum, to add an item, and the button of diagrams, where we have used a modal to have a pop up where we can see the progress once we have data. Finally, in the upper right corner, we have the option of log out.

![concept student](https://user-images.githubusercontent.com/43374601/52182546-7cc56b00-27fe-11e9-9dbd-a3468ad1c9f1.png)

Questions: It is a view to add questions, where in each type of question there is a generate button to create the dialogue of the question of that type.

![questions](https://user-images.githubusercontent.com/43374601/52182549-7fc05b80-27fe-11e9-9697-4bb71a6574d5.png)

## Navigation diagrams

![diagrama de navegacion](https://user-images.githubusercontent.com/43374601/52230742-772c5b80-28b8-11e9-94e1-6429b913092a.jpeg)

## Bibliography
1. [Página principal]( https://www.creative-tim.com/product/material-dashboard)
2. [Demo](https://demos.creative-tim.com/material-dashboard/examples/dashboard.html)
3. [Repositorio GitHub para descargar](https://github.com/creativetimofficial/material-dashboard)
4. [Documentación:](https://demos.creative-tim.com/material-dashboard/docs/2.1/components/breadcrumb.html)
5. [Echarts](https://ecomfe.github.io/echarts-doc/public/en/index.html)

## PHASE 2
### Navigation diagrams
![diagrama de navegacion](https://user-images.githubusercontent.com/46897050/53312120-0f17d680-38b4-11e9-83d5-48c021a6e65c.jpg)

####  screenshots

Login:
![login](https://user-images.githubusercontent.com/46897050/53310412-138cc100-38ad-11e9-966f-109255883ff6.jpg)

Main Page Teacher :
![mainpage teacher1](https://user-images.githubusercontent.com/46897050/53310437-36b77080-38ad-11e9-88f9-06b601aa0b44.jpg)
![mainpage teacher2](https://user-images.githubusercontent.com/46897050/53310455-48991380-38ad-11e9-8e97-f3ea0c2ac8de.jpg)

Main Page Student:
![mainpage student1](https://user-images.githubusercontent.com/46897050/53310413-138cc100-38ad-11e9-88f7-528da9c537e1.jpg)
![mainpage student4](https://user-images.githubusercontent.com/46897050/53310450-433bc900-38ad-11e9-8ff4-a032a8ee28ad.jpg)

Main Page Visitor:
![mainpage visitante1](https://user-images.githubusercontent.com/46897050/53310420-1edfec80-38ad-11e9-9c1b-db2d3346b947.jpg)

Sign in:
![sign in](https://user-images.githubusercontent.com/46897050/53310664-189e4000-38ae-11e9-93ed-f59f419f97ca.jpg)

Teacher concept view:
![concept teacher](https://user-images.githubusercontent.com/46897050/53311833-c27fcb80-38b2-11e9-8667-fd7f852297cb.jpg)

Student concept view:
![concept s](https://user-images.githubusercontent.com/46897050/53311888-0a9eee00-38b3-11e9-97a5-892528201cfc.jpg)

Add question:
![generar](https://user-images.githubusercontent.com/46897050/53311890-0a9eee00-38b3-11e9-93b3-4d6ca671c373.jpg)

### Development environment
To begin with we had to decide what environment we wanted to use.
In our case it was INTELLIJ.
The configuration of the environment was not very laborious, since it has a spring initializer, which creates the project with the dependencies that you mark (mustache, security ....).
Once this was done we decided that the first step was to connect to the database, download MYSQL Workbench to put it to work and MYSQLServer to manage a server on localhost.
The sentences introduced in our case can be found in the aplication.properties:

spring.jpa.hibernate.ddl-auto = create-drop
spring.datasource.url = jdbc: mysql: // localhost: 3306 / daw_group9? useSSL = false & useLegacyDatetimeCode = false & serverTimezone = UTC
spring.datasource.username = Group9
spring.datasource.password = URJCDAWGrupo9
server.port = 8443
server.ssl.key-store = classpath: keystore.jks
server.ssl.key-store-password = password
server.ssl.key-password = secret

spring.http.multipart.max-file-size = 10MB
spring.http.multipart.max-request-size = 10MB

Once connected to the environment we had to familiarize ourselves with the tags @ Entity, @ ManyToOne .... And so we finally managed to create a DB according to our requirements.

### Entity diagram
![diagrama de clases bbdd](https://user-images.githubusercontent.com/46897050/53304966-bdebf080-387b-11e9-8026-2ebd933f7413.jpg)

The database is composed of the following entities:Answer, Concept, Question, Item, User and Lesson.  Each of the entities has a series of field, as we can see in the photo

Association relations:
- Answer with Question

Composition relations:
- Lesson with Concept
- User with Answer
- Concept with Question
- Concept with Item

### Class diagram and templates
Complete diagram, all classes and relationshp:

![diagrama de clases y templates](https://user-images.githubusercontent.com/46897050/53306284-605fa000-388b-11e9-8e0f-df6c32e5db3c.jpg)

Since there are so many classes and relationships, the diagram looks very bad, so we have summarized the diagram as follows:

![diagrama de clases y templates1](https://user-images.githubusercontent.com/46897050/53306386-bed94e00-388c-11e9-9d14-29410c31b268.jpg)

We use the MVC architecture patter( Model-View-Controller).

MODEL:
- @Service
- Repository 
- @Entity
- @Component
- @Configuration

CONTROLLER
- @Controller
- @SpringBootApplication

VIEW
- Templates
- Error

All entities and all repositories have a composition relationship with DatabaseInitializer.

![Diagrama model1](https://user-images.githubusercontent.com/46897050/54070688-5b272b80-4263-11e9-9d92-03e0b0146bc3.jpg)

![Diagrama model2](https://user-images.githubusercontent.com/46897050/54070689-5b272b80-4263-11e9-9abc-c852b5568879.jpg)

@Service
- ItemService has an association relationship with Concept
- AnswerService has an association relationship with: Question and User
- ConceptService
- LessonService
- QuestionService

Repository (Interface)
- LessonRepository 
- QuestionRepository has an association relationship with Concept
- AnswerRepository has an association relationship with: Question and User
- UserRepository
- ConceptRepository
- ItemRepository has an association relationship with Concept

@Entity: Concept, Question, Answer, Item, User and Lesson. The relationships between them are the same as the picture of the entity diagram

@Component
- DatabaseInitializer
- AuthenticationProviderUser has an association relationship with: UserComponent, UserRepository and User.
- UserComponent

@Configuration: CSRFHandlerConfiguration and SecurityConfiguration

![Diagrama view](https://user-images.githubusercontent.com/46897050/54070776-a55cdc80-4264-11e9-931f-b04279e526b6.jpg)

Error
- 403
- 404
- 500

Templates
- StartedView_Visitor
- header
- StartedView_Teacher
- footer
- Items
- TeacherConcept_View has an association relationship with: header and footer
- MainPageStudent
- MainPageTeacher
- StudentConceptView has an association relationship with: header and footer
- MainPage
- ModalMainPage
- Sign_in has an association relationship with: footer and header
- Login has an association relationship with: footer and header
- lesson
- addnewQuestion

![Diagrama controller](https://user-images.githubusercontent.com/46897050/54070740-25367700-4264-11e9-9e92-221ad6a2545b.jpg)

![Controller y Model1](https://user-images.githubusercontent.com/46897050/54070739-25367700-4264-11e9-8e01-72b23eb60fae.jpg)

![Model y Controller2](https://user-images.githubusercontent.com/46897050/54070741-25367700-4264-11e9-951c-5832e270041a.jpg)

![Model y Controller3](https://user-images.githubusercontent.com/46897050/54070742-25367700-4264-11e9-86e6-7f7357d0e65c.jpg)

![View y Controller](https://user-images.githubusercontent.com/46897050/54070777-a55cdc80-4264-11e9-8607-7ba37f971ed8.jpg)

@Controller
- QuestionController has an association relationship with: QuestionService, Concept, ConceptService, ItemService, Item, Question, StudentConceptView, TeacherConcept_View and addnewQuestions.
- AnswerController has an association relationship with: Answer, AnswerService, Question, QUestionService, UserComponent and TeacherConcept_View
- ConceptController has an association relationship with: Concept, ConceptRepository, ConceptService, ItemRepository, LessonService, QuestionRepository, AnswerRepository, UserRepository, Lesson and MainPage
- IndexController has an association relationship with: UserRepository and login
- ItemController has an association relationship with: Concept, ConceptService, Item, ItemRepository, ItemService, QuestionRepository, TeacherConcept_View and Items
- LessonController has an association relationship with: Lesson, LessonService, UserComponent, MainPage and lesson
- MainController has an association relationship with: AnswerRepository, Concept, ConceptRepository, ConceptService, ItemRepository, ItemSrvice, LessonService, Question, QuestionRepository, User, UserComponent, UserRepository, QuestionService, Answer, AnswerService, StudentConceptView, sign_in, login, TeacherConcept_View, addnewQuestion and MainPage

@SpringBootApplication
- DawApplication

All classes and all views have a composition relationship with DawApplication.

### Bibliography

## PHASE 3
### API REST Documentation

All URLs begin with: https://localhost:8443

#### ANSWER

The format of the answer URLs is: /api/answer

For each operation the format changes, words or parameters are added

Operations:

GET
- Get Answer: /{id} 
- Get Answer by User: /user/{idUser}
- Get Answer by Question: /concept/{idConcept}

POST
- Create Answer: /{idQuestion}
- Correct Answer 1: /sendAnswerTypeOne/{idQuestion}
- Correct Answer 2: /sendAnswerTypeTwo/{idQuestion}/{ret}/{total}

Below we can see the format of the input and output information:

![Captura de pantalla 2019-03-10 a las 18 53 58](https://user-images.githubusercontent.com/46897050/54090081-b8f56980-4370-11e9-9564-0792c573f3ef.png)

![Captura de pantalla 2019-03-10 a las 18 54 13](https://user-images.githubusercontent.com/46897050/54090082-b8f56980-4370-11e9-95a0-6f367ca092e1.png)

![Captura de pantalla 2019-03-11 a las 00 25 34](https://user-images.githubusercontent.com/32453276/54093087-12bb5b00-4394-11e9-8ed0-627e42e81d1e.JPG)

#### CONCEPT

The format of the answer URLs is: /api/concept

For each operation the format changes, words or parameters are added

Operations:

GET
- Get Concept: /{id} 
- Get Concepts by Id Lesson: /lesson/{idLesson}

POST
- Create Concept: /lesson/{idLesson}. If we add to the URL: /?page=0&size=10, we get the pagination
- Upload image: /image/{id} to accese to image uploaded is with https://loacalhost/uploads/{filename}

DELETE
- Delete Concept: /{id}

Below we can see the format of the input and output information:

![Captura de pantalla 2019-03-10 a las 14 53 08](https://user-images.githubusercontent.com/46897050/54090493-0c69b680-4375-11e9-9956-84a382c65142.png)

![Captura de pantalla 2019-03-10 a las 14 53 16](https://user-images.githubusercontent.com/46897050/54090494-0c69b680-4375-11e9-8977-583889666cb0.png)

![Captura de pantalla 2019-03-11 a las 00 29 18](https://user-images.githubusercontent.com/32453276/54093146-b0af2580-4394-11e9-89ed-178f73705733.JPG)

EXAMPLE UPDATING AND SEEING IMAGE
![imageuploads](https://user-images.githubusercontent.com/32453276/54105299-e541d200-43d2-11e9-807e-a5045f73f9e2.JPG)

![SeeImage](https://user-images.githubusercontent.com/32453276/54105300-e541d200-43d2-11e9-8b4b-4ca56db3bd49.JPG)



#### ITEMS

The format of the answer URLs is: /api/items

For each operation the format changes, words or parameters are added

Operations:

GET
- Get item: /{id} 
- Get Items by Concept: /concept/{idConcept}

POST
- Create Item: /concept/{idConcept}

DELETE
- Delete item: /{id}

Below we can see the format of the input and output information:

![Captura de pantalla 2019-03-10 a las 18 55 10](https://user-images.githubusercontent.com/46897050/54090543-869a3b00-4375-11e9-96d0-e1d1930bc5aa.png)

![Captura de pantalla 2019-03-10 a las 18 55 29](https://user-images.githubusercontent.com/46897050/54090544-869a3b00-4375-11e9-8754-289cb9af8916.png)

#### LESSON

The format of the answer URLs is: /api/lesson

For each operation the format changes, words or parameters are added

Operations:

GET
- Show lessons: /pag. If we add to the URL: /?page=1&size=10, we get the pagination  
- Show lesson: /{id}

POST
- Create Lesson: /

DELETE
- Delete lesson: /{id}

Below we can see the format of the input and output information:

![Lesson-1](https://user-images.githubusercontent.com/46897050/54090594-12ac6280-4376-11e9-8e0b-0b6526b48666.jpeg)

![Lesson-2](https://user-images.githubusercontent.com/46897050/54090595-12ac6280-4376-11e9-97dd-050fdcfe108b.jpeg)

#### QUESTION

The format of the answer URLs is: /api/question

For each operation the format changes, words or parameters are added

Operations:

GET 
- Get Question: /{id}

POST
- Create Question: /concept/{idConcept}

DELETE
- Delete Question: /{id}

Below we can see the format of the input and output information:

![Question-1](https://user-images.githubusercontent.com/46897050/54090618-64ed8380-4376-11e9-81dc-cdcbdca93272.jpeg)

#### USER

The format of the answer URLs is: /api/user

For each operation the format changes, words or parameters are added

Operations:

GET 
- Login: /login
- Logout: /logout
- Get User by name: /{name}

POST
- Register: /register

Below we can see the format of the input and output information:

![User-1](https://user-images.githubusercontent.com/46897050/54090660-bd248580-4376-11e9-889a-5fe4ea4ea104.jpeg)

![User-2](https://user-images.githubusercontent.com/46897050/54090661-bd248580-4376-11e9-86eb-3c9451d879e0.jpeg)

### Class diagram updates
In the following image we can see the diagram of classes and templates summarized and updated:

![Diagrama de clases y templates1](https://user-images.githubusercontent.com/46897050/54071315-1dc69c00-426b-11e9-8817-5a8c18282732.jpg)

As we can see, the classes @RestController and @ControllerAdvice have been added. These classes are part of the Controller.

New classes:

![Diagrama model1](https://user-images.githubusercontent.com/46897050/54085146-ca238380-433a-11e9-8adb-0a5af84f30de.jpg)

![Diagrama model2](https://user-images.githubusercontent.com/46897050/54085147-ca238380-433a-11e9-8a08-1b50dfa311ad.jpg)

MODEL:
@Service
- UploadFileServiceImpli

Repository (Interface)
- IUploadFileService

@Configuration
- MvcConfig
- SecurityApiRest
- JsonAdapterWithPageable

![Diagrama controller](https://user-images.githubusercontent.com/46897050/54085157-ed4e3300-433a-11e9-96d0-641cb7d12da0.jpg)

All classes and all views have a composition relationship with DawApplication.

![Controller y Model1](https://user-images.githubusercontent.com/46897050/54085165-07881100-433b-11e9-8319-f12a183f7d83.jpg)

![Model y Controller2](https://user-images.githubusercontent.com/46897050/54085167-0820a780-433b-11e9-88e5-961027f9fee1.jpg)

![Model y Controller3](https://user-images.githubusercontent.com/46897050/54085168-0820a780-433b-11e9-8b97-0fc05a4602fd.jpg)

CONTROLLER:
@RestController
- ConceptRest has an association relationship with: Concept, Question, Item, Lesson, UploadFileServiceImpli, LessonService and ConceptService
- QuestionRest has an association relationship with: Concept, Question, Item, Answer, ConceptService and QuestionService
- ItemRest has an association relationship with: Concept, Question, Item, ConceptService and ItemService
- AnswerRest has an association relationship with: Question, Answer, User, UserComponent, ConceptService, QuestionService and AnswerService
- LessonsRest has an association relationship with: Concept, Lesson and LessonService
- UserRest has an association relationship with: User, UserService and UserComponent

![Diagrama controller1](https://user-images.githubusercontent.com/46897050/54085166-07881100-433b-11e9-895f-8f7530ed259c.jpg)

All @RestController inherit from class OperationsRest

- OperationsRest

@ControllerAdvice
- RestControllerExceptionHandler

### Dockerized application execution instructions
First of all we're going to explain the configuration files and scripts we have.
   -Dockerfile: File for building the app image.
   -docker-compose.yml: Here we definied the two services that we have used, database(daw_grupo9) and app (daw).
   -syncWithDB.sh: The funcionality of this file is sync up the app with the database.
   -create_image.sh: This script is responsible for creating the app image, build and push to the DockerHub.
   The database image is the mysql official image we have in DockerHub.

#### Run the dockerized application - Terminal
 1. Execute the script: sh create_image.sh
 
 2. Start docker-compose: docker-compose up 
    If we want execute it in background we need to use the command:
    docker-compose up -d (Deamon mode)

### Preparation of development environment
We use IntelliJ IDEA Ultimate and Docker-Desktop. When we created the configuration files (Dockerfile and docker-compose.yml), IntelliJ detected it automatically, we didn't have to install any plugin.

#### Run the dockerized application - IntelliJ
 1. Edit Configuration:
   In Run / Debug we have a Docker section, here we can choose between docker, docker image and docker compose, last one is
   the option we choose for this project.
 2. Settings Server Docker:
   In this step, we have to edit some fields with the next information:
     Server: Docker
     Compose file: ./docker-compose.yml; 
 3. Run:
   Now we can run the application as we normally do, but before check if we have selected docker-compose.yml as chosen 
   application.
 
 Thing to keep in mind:
  If we use some script in our configuration files we have to give the corresponding permissions to IntelliJ for executing it.

### Bibliography

## PHASE 4
### Preparation of development environment
 Se añadirá a las instrucciones cómo instalar y configurar el entorno de desarrollo para poder compilar y ejecutar la aplicación SPA con Angular.
### Class diagram and templates
 Reflejará las clases y templates del código Angular. El diagrama deberá diferenciar claramente qué elementos son componentes y cómo se relacionan entre sí (relaciones padre-hijo). También se deberán incluir los servicios y el resto de clases auxiliares.
### Bibliography
